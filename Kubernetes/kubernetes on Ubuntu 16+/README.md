# __kubernetes on Ubuntu 16+__
### _The repository contains the steps to build a kubernetes cluster from scratch._
### _It includes installing Docker Engine, CRI-dockerd adapter to act as shim between docker and k8s._
### _Later on, the final kubernetes tools such as kubeadm, kubelet, kubectl are installed._

---
## __Installation__

```bash
./deploy_k8s.sh
```

---

## __Post Installation__

### After the installation of tools, configure it based on what kind of node it would be. Out of many nodes, atleast one must be chosen as master.
### The only difference between worker node and master is, during the initializing stage, installs the cluster control plane components.
---
### ***Setup Master node***

#### Make one of the node as master in a multi node cluster. To do that, initialize the kubeadm with server parameters.

```
kubeadm init --apiserver-advertise-address=[server_ip] --pod-network-cidr=[pod netwrok cidr] --cri-socket=unix:///var/run/cri-dockerd.sock
```

### _Initialition first runs a series of prechecks to ensure that the machine is ready to run kubernetes. These prechecks expose warnings and exit on errors. Kubeadm init then downloads and installs the cluster control plane components. This make take several minutes. After it finishes able to see:_

>  Your Kubernetes control-plane has initialized successfully!

### To start using your cluster, you need to run the following as a regular user:

```
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

---
### ***Setup Worker nodes***

### Once a node has been selected as master, join workers to the master by the following sytax as root.

```
kubeadm join [master_ip]:6443 --token [from master node] --discovery-token-ca-cert-hash [hash generated by master] --cri-socket unix:///var/run/cri-dockerd.sock
```

### Once the worker has joined, you will get the following output.
> This node has joined the cluster.
> * Certificate signing request was sent to apiserver and a response was received.
> * The Kubelet was informed of the new secure connection details.

> Run 'kubectl get nodes' on the control-plane to see this node join the cluster.

### _In case you missed to save the token when master was created, generate a new one in master node by:_
```
kubeadm token create --print-join-command
```

---

## _References_

- [Prerequisites](https://kubernetes.io/docs/setup/production-environment/container-runtimes/)
- [Install docker](https://docs.docker.com/engine/install/ubuntu/)
- [Install GO](https://go.dev/doc/install)
- [cri-dockerd](https://github.com/Mirantis/cri-dockerd)
- [Install Kubeadm](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#check-required-ports)
- [Creating cluster](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/)

![Kubernetes logo](./ks.png "k8s")

---

[Source](https://github.com/abuharis/kubernetes)